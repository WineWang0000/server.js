<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>data-server</title>
</head>
<body>
	<h5>您的账户余额是<span id=amount>100</span></h5>
	<form action="/pay" method="POST"></form>
	<button>付款</button>
	<script src="a.js">
		button.addEventListener('click', function(e){
		  let script = document.createElement('script')
			script.src = './pay'
			document.body.appendChild(script)
			script.onload = function(e){
				e.currentTarget.remove()
			}
		})
		
		/*
		用JSONP实现

		button.addEventListener('click', (e)=>{
			let script = document.createElement('script')
			let functionName = 'frank'+ parseInt(Math.random()*10000000 ,10)
			window[functionName] = function(){  // 每次请求之前搞出一个随机的函数
				amount.innerText = amount.innerText - 0 - 1
      }
			script.src = '/pay?callback=' + functionName
			document.body.appendChild(script)
			script.onload = function(e){ // 状态码是 200~299 则表示成功
				e.currentTarget.remove()
				delete window[functionName] // 请求完了就干掉这个随机函数
      }
			script.onerror = function(e){ // 状态码大于等于 400 则表示失败
				e.currentTarget.remove()
				delete window[functionName] // 请求完了就干掉这个随机函数
			}
    })
		*/
	</script>
</body>
</html>